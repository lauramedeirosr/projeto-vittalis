<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" lang="pt-br">
<head>
    <link rel="icon" type="imagem/png" th:href="@{/img/sub-logo1.png}">
    <link rel="stylesheet" th:href="@{/css/cadastro.css}"/>
    <th:block th:replace="fragments/config :: config"></th:block>
    <title>Formulário de Atualização de Clientes</title>
</head>

<body>

<div th:replace="fragments/header :: header"></div>
<main>
    <h2 class="formulario d-flex justify-content-center mb-4">Formulário de Atualização do Cliente</h2>
    <br>
    <div class="container mx-auto d-block">
        <!--/*@thymesVar id="cliente" type=""*/-->
        <form class="registration-form" th:action="@{/cliente/atualizar}" th:object="${cliente}" method="post" novalidate>
            <input type="hidden" th:field="*{id}">

            <!-- Nome Completo -->
            <div class="form-group row mb-4">
                <h3 class="dados">Dados pessoais</h3>
                <br>
                <div class="col-sm-12">
                    <small class="nomeInput form-text text-muted d-block mt-1">Nome Completo</small>
                    <input type="text" th:field="*{nomeCompleto}" class="form-control" id="nomeCompleto"
                           name="nomeCompleto" required>
                </div>
            </div>

            <!-- E-mail -->
            <div class="form-group row mb-4">
                <div class="col-sm-12">
                    <small class="nomeInput form-text text-muted d-block mt-1">E-mail</small>
                    <input type="email" th:field="*{email}" class="form-control" id="email" name="email" required
                           placeholder="exemplo@exemplo.com"/>
                </div>
            </div>

            <!-- Número de Telefone -->
            <div class="form-group row mb-4">
                <div class="col-sm-12">
                    <small class=" nomeInput form-text text-muted d-block mt-1">Telefone</small>
                    <input type="text" th:field="*{telefone}" class="form-control" id="telefone" required
                           placeholder="(00) 00000-0000" pattern="\([0-9]{2}\) [0-9]{4,5}-[0-9]{4}"/>
                </div>
            </div>

            <div class="row mb-2">
                <div class="col-md-6 mb-2 mb-md-0">
                    <small class=" nomeInput form-text text-muted d-block mt-1">CPF</small>
                    <input type="text" th:field="*{cpf}" class="form-control" id="cpf" required
                           placeholder="000.000.000-00" pattern="\d{3}\.\d{3}\.\d{3}-\d{2}"/>
                </div>

                <div class="col-md-6">
                    <small class=" nomeInput form-text text-muted d-block mt-1">Data de Nascimento</small>
                    <input type="date" th:field="*{dataNascimento}" class="form-control" id="dataNascimento" required/>
                </div>
            </div>

            <br>
            <!-- Endereço -->
            <div class="form-group row mb-4">
                <h3 class="dados">Endereço</h3>
                <br>
                <div class="col-sm-12">

                    <!-- CEP -->
                    <div>
                        <small class="nomeInput form-text text-muted d-block mt-1">CEP</small>
                        <input type="text" th:field="*{endereco.cep}" class="form-control" id="cep" required
                               pattern="\d{5}-?\d{3}" placeholder="00000-000">
                    </div>

                    <!-- Rua -->
                    <div class="mb-2">
                        <small class="nomeInput form-text text-muted d-block mt-1">Rua</small>
                        <input type="text" th:field="*{endereco.rua}" class="form-control" id="rua" required>
                    </div>

                    <div>
                        <small class="nomeInput form-text text-muted d-block mt-1">Bairro</small>
                        <input type="text" th:field="*{endereco.bairro}" class="form-control" id="bairro" required>
                    </div>

                    <div class="mb-2">
                        <small class=" nomeInput form-text text-muted d-block mt-1">Número da residência</small>
                        <input type="text" th:field="*{endereco.numero}" class="form-control" id="numero" required>
                    </div>

                    <!-- Complemento -->
                    <div class="mb-2">
                        <small class="nomeInput form-text text-muted d-block mt-1">Complemento</small>
                        <input type="text" th:field="*{endereco.complemento}" class="form-control" id="complemento">
                    </div>

                    <!-- Cidade / Estado -->
                    <div class="row mb-2">
                        <div class="col-md-6 mb-2 mb-md-0">
                            <small class="nomeInput form-text text-muted d-block mt-1">Cidade</small>
                            <input type="text" th:field="*{endereco.cidade}" class="form-control" id="cidade" required>
                        </div>

                        <div class="col-md-6">
                            <small class="nomeInput form-text text-muted d-block mt-1">UF</small>
                            <input type="text" th:field="*{endereco.uf}" class="form-control" id="uf" name="uf" required
                                   maxlength="2" style="text-transform: uppercase;">
                        </div>
                    </div>
                    <div class="mb-2">
                        <small class="nomeInput form-text text-muted d-block mt-1">Senha</small>
                        <input type="password" th:field="*{senha}" class="form-control" id="senha" name="senha"
                               required>
                    </div>
                </div>

                <div class="form-group row mt-4 col-sm-12">
                    <div class="divBotoes col-sm-12 d-flex justify-content-center">
                        <div class="text-center">
                            <button type="submit" class="botaoCadastrar">Salvar</button>
                        </div>
                        <div class="text-center">
                            <button type="reset" class="botaoCadastrar" th:form="reset">Limpar</button>
                        </div>
                        <div class="text-center">
                            <button type="button" class="botaoCadastrar" onclick="window.location.href='/cliente'">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->

        </form>
    </div>
</main>

<div th:replace="fragments/footer :: footer"></div>


<!-- Adicione este script no final do body -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const cepInput = document.getElementById('cep');
        const ruaInput = document.getElementById('rua');
        const bairroInput = document.getElementById('bairro');
        const cidadeInput = document.getElementById('cidade');
        const ufInput = document.getElementById('uf');
        const numeroInput = document.getElementById('numero'); // Para focar após preenchimento

        if (cepInput) {
            cepInput.addEventListener('blur', function () {
                const cepValue = this.value.replace(/\D/g, ''); // Remove non-digits

                if (cepValue.length === 8) {
                    // Limpa campos antes de nova consulta (exceto CEP)
                    ruaInput.value = '';
                    bairroInput.value = '';
                    cidadeInput.value = '';
                    ufInput.value = '';

                    // Mostra "carregando" nos campos
                    ruaInput.value = '...';
                    bairroInput.value = '...';
                    cidadeInput.value = '...';
                    ufInput.value = '...';


                    fetch(`https://viacep.com.br/ws/${cepValue}/json/`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Erro na requisição: ' + response.status);
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (data.erro) {
                                alert('CEP não encontrado.');
                                // Limpa campos se CEP não encontrado
                                ruaInput.value = '';
                                bairroInput.value = '';
                                cidadeInput.value = '';
                                ufInput.value = '';
                                cepInput.focus();
                            } else {
                                ruaInput.value = data.logradouro || '';
                                bairroInput.value = data.bairro || '';
                                cidadeInput.value = data.localidade || '';
                                ufInput.value = data.uf || '';

                                // Se a rua foi preenchida, foca no número
                                if (data.logradouro) {
                                    numeroInput.focus();
                                } else {
                                    // Se a rua não veio (CEP geral da cidade), foca na rua
                                    ruaInput.focus();
                                }
                            }
                        })
                        .catch(error => {
                            console.error('Falha ao buscar CEP:', error);
                            alert('Não foi possível consultar o CEP. Verifique sua conexão ou tente novamente.');
                            // Limpa campos em caso de erro
                            ruaInput.value = '';
                            bairroInput.value = '';
                            cidadeInput.value = '';
                            ufInput.value = '';
                        });
                } else if (cepValue.length > 0) { // Se digitou algo mas não tem 8 dígitos
                    alert('CEP inválido. Deve conter 8 dígitos.');
                    // Limpa campos se CEP inválido
                    ruaInput.value = '';
                    bairroInput.value = '';
                    cidadeInput.value = '';
                    ufInput.value = '';
                } else { // Se o campo CEP está vazio, limpa os outros
                    ruaInput.value = '';
                    bairroInput.value = '';
                    cidadeInput.value = '';
                    ufInput.value = '';
                }
            });
        }

        // Adiciona uma máscara simples para o CEP (opcional, mas melhora UX)
        if (cepInput) {
            cepInput.addEventListener('input', function (e) {
                let value = e.target.value.replace(/\D/g, ''); // Remove tudo que não é dígito
                if (value.length > 5) {
                    value = value.substring(0, 5) + '-' + value.substring(5, 8);
                }
                e.target.value = value;
            });
        }
    });
</script>

</body>
</html>