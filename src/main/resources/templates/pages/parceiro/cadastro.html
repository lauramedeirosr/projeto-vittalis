<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" lang="pt-br">
<head>
    <link rel="icon" type="imagem/png" th:href="@{/img/sub-logo1.png}">
    <link rel="stylesheet" th:href="@{/css/cadastro.css}"/>
    <th:block th:replace="fragments/config :: config"></th:block>
    <!-- Título dinâmico -->
    <title th:text="${parceiro.id == null} ? 'Novo Parceiro' : 'Alterar Parceiro'">Formulário</title>
</head>

<body>

<div th:replace="fragments/header-adm :: header"></div>
<main>
    <br>
    <h2 class="formulario d-flex justify-content-center mb-4"
        th:text="${parceiro.id == null} ? 'Cadastro de Parceiro' : 'Alterar Dados do Parceiro'">
        Formulário de Cadastro
    </h2>
    <br>
    <div class="container mx-auto d-block">
        <form class="registration-form" th:action="@{/parceiro/salvar}" th:object="${parceiro}" method="post" novalidate>

            <input type="hidden" th:field="*{id}" />

            <!-- Nome Completo -->
            <div class="form-group row mb-4">
                <h3 class="dados">Dados Responsável</h3>
                <br>
                <div class="col-sm-12">
                    <small class="nomeInput form-text text-muted d-block mt-1">Nome do Responsável</small>
                    <input type="text" th:field="*{nomeResponsavel}" class="form-control" id="nomeResponsavel"
                           name="nomeResponsavel" placeholder="Fulano da Silva" required
                           th:classappend="${#fields.hasErrors('nomeResponsavel')} ? 'is-invalid' : ''">
                    <span class="mensagem-erro" th:if="${#fields.hasErrors('nomeResponsavel')}" th:errors="*{nomeResponsavel}"></span>
                </div>
            </div>

            <!-- E-mail -->
            <div class="form-group row mb-4">
                <div class="col-sm-12">
                    <small class="nomeInput form-text text-muted d-block mt-1">E-mail</small>
                    <input type="email" th:field="*{email}" class="form-control" id="email" name="email"
                           placeholder="exemplo@exemplo.com" required
                           th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''"/>
                    <span class="mensagem-erro" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></span>
                </div>
            </div>

            <!-- Número de Telefone -->
            <div class="form-group row mb-4">
                <div class="col-sm-12">
                    <small class=" nomeInput form-text text-muted d-block mt-1">Telefone</small>
                    <input type="text" th:field="*{telefone}" class="form-control" id="telefone"
                           placeholder="(00) 00000-0000" pattern="\([0-9]{2}\) [0-9]{4,5}-[0-9]{4}"
                           required th:classappend="${#fields.hasErrors('telefone')} ? 'is-invalid' : ''"/>
                    <span class="mensagem-erro" th:if="${#fields.hasErrors('telefone')}" th:errors="*{telefone}"></span>
                </div>
            </div>

            <div class="row mb-2">
                <div class="col-md-6 mb-2 mb-md-0">
                    <small class=" nomeInput form-text text-muted d-block mt-1">CPF:</small>
                    <input type="text" id="cpf" th:field="*{cpf}" maxlength="14" placeholder="000.000.000-00" class="form-control"
                           th:classappend="${#fields.hasErrors('cpf')} ? 'is-invalid' : ''" />
                    <span class="mensagem-erro" th:if="${#fields.hasErrors('cpf')}" th:errors="*{cpf}"></span>
                </div>
            </div>

            <br>
            <!-- Empresa -->
            <div class="form-group row mb-4">
                <h3 class="dados">Dados da Empresa</h3>
                <br>
                <div class="col-sm-12">

                    <div class="mb-2">
                        <small class="nomeInput form-text text-muted d-block mt-1">Nome da Empresa</small>
                        <input type="text" th:field="*{nomeEmpresa}" class="form-control" id="nomeEmpresa"
                               placeholder="nome" th:classappend="${#fields.hasErrors('nomeEmpresa')} ? 'is-invalid' : ''"/>
                        <span class="mensagem-erro" th:if="${#fields.hasErrors('nomeEmpresa')}" th:errors="*{nomeEmpresa}"></span>
                    </div>

                    <!-- CNPJ -->
                    <div>
                        <small class="nomeInput form-text text-muted d-block mt-1">CNPJ</small>
                        <!-- ALTERAÇÃO 1: Adicionado maxlength, onkeyup e corrigido o pattern -->
                        <input type="text" th:field="*{cnpj}" class="form-control" id="cnpj"
                               maxlength="18"
                               placeholder="00.000.000/0000-00"
                               onkeyup="mascaraCNPJ(this)"
                               required/>
                        <span class="mensagem-erro" th:if="${#fields.hasErrors('cnpj')}" th:errors="*{cnpj}"></span>
                    </div>

                    <div class="mb-2">
                        <small class="nomeInput form-text text-muted d-block mt-1">Serviço</small>
                        <input type="text" th:field="*{servico}" class="form-control" id="servico"
                               placeholder="Serviço" th:classappend="${#fields.hasErrors('servico')} ? 'is-invalid' : ''"/>
                        <span class="mensagem-erro" th:if="${#fields.hasErrors('servico')}" th:errors="*{servico}"></span>
                    </div>

                    <div class="mb-2">
                        <small class=" nomeInput form-text text-muted d-block mt-1">Percentual Lucro</small>
                        <input type="number" step="0.01" th:field="*{percentualLucro}" class="form-control" id="percentualLucro"
                               placeholder="%"
                               th:classappend="${#fields.hasErrors('percentualLucro')} ? 'is-invalid' : ''" required>
                        <span class="mensagem-erro" th:if="${#fields.hasErrors('percentualLucro')}" th:errors="*{percentualLucro}"></span>
                    </div>

                </div>

                <div class="form-group row mt-4 col-sm-12">
                    <div class="divBotoes col-sm-12 d-flex justify-content-center">
                        <div class="text-center">
                            <button type="submit" class="botaoCadastrar">Salvar</button>
                        </div>
                        <div class="text-center">
                            <button type="reset" class="botaoCadastrar" th:if="${parceiro.id == null}">Limpar</button>
                        </div>
                        <div class="text-center">
                            <button type="button" class="botaoCadastrar" onclick="window.location.href='/parceiro/listar'">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</main>

<div th:replace="fragments/footer :: footer"></div>
<div th:replace="fragments/scripts :: scripts"></div>

<!-- ALTERAÇÃO 2: Script para formatar o CNPJ automaticamente -->
<script>
    function mascaraCNPJ(i) {
        var v = i.value;

        // Remove tudo o que não é dígito
        v = v.replace(/\D/g, "");

        // Coloca ponto entre o segundo e o terceiro dígitos
        v = v.replace(/^(\d{2})(\d)/, "$1.$2");

        // Coloca ponto entre o quinto e o sexto dígitos
        v = v.replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3");

        // Coloca uma barra entre o oitavo e o nono dígitos
        v = v.replace(/\.(\d{3})(\d)/, ".$1/$2");

        // Coloca um hífen depois do bloco de quatro dígitos
        v = v.replace(/(\d{4})(\d)/, "$1-$2");

        i.value = v;
    }
</script>

</body>
</html>